<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Sincronizaci√≥n de Eventos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #2563eb;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1e40af;
        }
        .log {
            background: #1e293b;
            color: #10b981;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px solid #334155;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        .warning { color: #f59e0b; }
    </style>
</head>
<body>
    <h1>üîÑ Test de Sincronizaci√≥n de Eventos</h1>
    
    <div class="card">
        <h2>Instrucciones</h2>
        <ol>
            <li>Abre esta p√°gina en dos pesta√±as diferentes</li>
            <li>En una pesta√±a, simula la edici√≥n de un evento</li>
            <li>Observa c√≥mo la otra pesta√±a detecta el cambio autom√°ticamente</li>
        </ol>
    </div>
    
    <div class="card">
        <h2>Acciones de Prueba</h2>
        <button onclick="simularCrearEvento()">Simular Crear Evento</button>
        <button onclick="simularEditarEvento(29)">Simular Editar Evento #29</button>
        <button onclick="simularEditarEvento(31)">Simular Editar Evento #31</button>
        <button onclick="limpiarLog()">Limpiar Log</button>
        <button onclick="abrirVenta()">Abrir P√°gina de Venta</button>
    </div>
    
    <div class="card">
        <h2>Log de Eventos</h2>
        <div class="log" id="log">
            <div class="log-entry info">Sistema iniciado. Esperando eventos...</div>
        </div>
    </div>
    
    <script>
        const log = document.getElementById('log');
        
        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        function limpiarLog() {
            log.innerHTML = '<div class="log-entry info">Log limpiado.</div>';
        }
        
        function simularCrearEvento() {
            addLog('Simulando creaci√≥n de evento...', 'info');
            localStorage.setItem('evt_upd', Date.now().toString());
            addLog('‚úì Evento "evt_upd" guardado en localStorage', 'success');
        }
        
        function simularEditarEvento(idEvento) {
            addLog(`Simulando edici√≥n del evento #${idEvento}...`, 'info');
            const data = {
                id_evento: idEvento,
                timestamp: Date.now()
            };
            localStorage.setItem('evento_actualizado', JSON.stringify(data));
            addLog(`‚úì Evento #${idEvento} actualizado en localStorage`, 'success');
        }
        
        function abrirVenta() {
            addLog('Abriendo p√°gina de venta...', 'info');
            window.open('index.php', '_blank');
        }
        
        // Escuchar cambios en localStorage
        window.addEventListener('storage', (e) => {
            if (e.key === 'evt_upd') {
                addLog('üîî Detectado: Nuevo evento creado', 'warning');
            }
            
            if (e.key === 'evento_actualizado' && e.newValue) {
                try {
                    const data = JSON.parse(e.newValue);
                    addLog(`üîî Detectado: Evento #${data.id_evento} editado`, 'warning');
                } catch (error) {
                    addLog('‚ùå Error al parsear evento_actualizado', 'error');
                }
            }
        });
        
        // Escuchar mensajes de otras ventanas
        window.addEventListener('message', (e) => {
            if (e.data && e.data.type === 'evento_actualizado') {
                addLog(`üì® Mensaje recibido: Evento #${e.data.id_evento} editado`, 'info');
            }
        });
        
        addLog('‚úì Listeners configurados correctamente', 'success');
    </script>
</body>
</html>
